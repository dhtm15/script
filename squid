#/bin/bash
mIP=`wget http://ipecho.net/plain -O - -q ; echo`
rm -rf /etc/squid3/squid.conf
touch /etc/squid3/squid.conf
echo 'acl ip dstdomain $mIP
acl payload dstdomain -i "/etc/payloads"
acl local dstdomain localhost
acl iplocal dstdomain 127.0.0.1
acl netflix dstdomain .netflix.
acl redelocal src 192.168.0.1-192.168.0.254
acl vpn src 10.8.0.1-10.8.0.254
acl videoprime dstdomain .videoprime.
acl ip4 dstdomain 127.0.0.2
acl oi dstdomain 200.222.108.241

http_access allow ip
http_access allow payload
http_access allow local
http_access allow iplocal
http_access allow redelocal
http_access allow vpn
http_access allow ip4
http_access allow oi
http_access allow netflix
http_access allow videoprime

http_port 80
http_port 8080
http_port 8799
http_port 3128

visible_hostname RNEOXBRASIL

http_access deny all

via off
forwarded_for off

# Ganhos de performançe na hierarchy_stoplist
hierarchy_stoplist cgi-bin ?
# Tempo limite de conexões aceitas e negadas
negative_ttl 3 minutes
positive_dns_ttl 5 minutes
# Terminar imediatamente conexões finalizadas de clientes
half_closed_clients off
# Desabilitar memory_pools (Ganho de performançe em RAM)
memory_pools off
# Fix
strip_query_terms off
detect_broken_pconn on
pipeline_prefetch off' > /etc/squid3/squid.conf
